<div class="category-page d-flex flex-lg-row flex-column gap-4 p-4 bg-white">

  <!-- Mobile Filter Toggle -->
  @if (isMobile) {
    <button type="button"
            class="btn btn-dark w-100 mb-3"
            (click)="toggleMobileFilters()">
      {{ showMobileFilters ? 'Close Filters' : 'Open Filters' }}
    </button>
  }

  <!-- Filters Sidebar -->
  <aside class="filters border rounded-4 p-3 bg-light flex-shrink-0"
         [class.active]="!isMobile || showMobileFilters">

    <h3 class="h5 fw-bold mb-3">Filters</h3>

    <!-- Category -->
    <h4 class="h6 fw-semibold d-flex justify-content-between align-items-center mb-2"
        (click)="toggleFilter('category')">Category ▼</h4>
    @if (openFilter === 'category') {
      <ul class="list-unstyled mb-3">
        @for (cat of categories; track cat) {
          <li class="mb-2">
            <button type="button" class="filter-btn w-100 text-start"
                    (click)="applyCategoryFilter(cat)">
              {{ cat }}
            </button>
          </li>
        }
      </ul>
    }

    <!-- Size -->
    <h4 class="h6 fw-semibold d-flex justify-content-between align-items-center mb-2"
        (click)="toggleFilter('size')">Size ▼</h4>
    @if (openFilter === 'size') {
      <ul class="list-unstyled mb-3">
        @for (s of sizes; track s) {
          <li class="mb-2">
            <button type="button" class="filter-btn w-100 text-start"
                    (click)="applySizeFilter(s)">
              {{ s }}
            </button>
          </li>
        }
      </ul>
    }

    <!-- Color -->
    <h4 class="h6 fw-semibold d-flex justify-content-between align-items-center mb-2"
        (click)="toggleFilter('color')">Color ▼</h4>
    @if (openFilter === 'color') {
      <ul class="list-unstyled d-flex flex-wrap gap-2 mb-3 color-list">
        @for (c of colors; track c) {
          <li>
            <button type="button" (click)="applyColorFilter(c)" [style.background]="c" class="color-btn"></button>
          </li>
        }
      </ul>
    }

    <!-- brand -->
    <h4 class="h6 fw-semibold d-flex justify-content-between align-items-center mb-2"
        (click)="toggleFilter('brand')">Brand ▼</h4>
    @if (openFilter === 'brand') {
      <ul class="list-unstyled mb-3">
        @for (st of brands; track st) {
          <li class="mb-2">
            <button type="button" class="filter-btn w-100 text-start"
                    (click)="applyBrandFilter(st)">
              {{ st }}
            </button>
          </li>
        }
      </ul>
    }

    <!-- Price -->
    <h4 class="h6 fw-semibold d-flex justify-content-between align-items-center mb-2"
        (click)="toggleFilter('price')">Price ▼</h4>
    @if (openFilter === 'price') {
      <div class="mb-3">
        <input type="range" class="form-range" [(ngModel)]="maxPrice" min="0" max="200" />
        <span class="small text-muted">Max: {{ maxPrice }}</span>
      </div>
    }

    <button type="button" class="btn btn-sm btn-outline-danger fw-semibold w-100 mt-2"
            (click)="resetFilters()">Reset Filters</button>
  </aside>

  <!-- Products Section -->
  <section class="products flex-grow-1 d-flex flex-column">
    <h2 class="h4 fw-bold mb-3">Products</h2>
    <div class="grid row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">
      @for (product of paginatedProducts; track product.id) {
        <div class="col">
          <app-product-card [product]="product"></app-product-card>
        </div>
      }
    </div>

    <div class="pagination d-flex justify-content-center align-items-center gap-3 mt-4">
      <button type="button" class="btn btn-dark btn-sm rounded-3 px-3"
              (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
      <span class="fw-semibold small">Page {{ currentPage }} / {{ totalPages }}</span>
      <button type="button" class="btn btn-dark btn-sm rounded-3 px-3"
              (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </section>
</div>
